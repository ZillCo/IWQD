<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>IoT Water Quality Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>
  <style>
    /* your CSS remains unchanged */
  </style>
</head>
<body>
  <!-- LOGIN BOX -->
  <div class="login-box" id="loginBox">
    <div>
      <h3>Sign In With Google</h3>
      <div
        id="g_id_onload"
        data-client_id="1082316602730-lasg1o8e0ub19u2dduv98i1il8qkl5u5.apps.googleusercontent.com"
        data-callback="handleGoogleLogin"
        data-auto_prompt="false"
      ></div>
      <div class="g_id_signin" data-type="standard"></div>
    </div>
  </div>

  <!-- DASHBOARD (hidden by default) -->
  <div id="dashboard" class="hidden">
    <header>
      <h1>IoT Water Quality Monitoring Dashboard</h1>
      <div>
        <button class="menu-button" onclick="toggleMenu()">â˜° Menu</button>
        <div id="menuPanel" class="menu-panel">
          <button onclick="toggleDarkMode()">ðŸŒ™ Toggle Dark Mode</button><br />
          <button onclick="toggleGraphType()">ðŸ“Š Switch Chart Type</button><br />
          <button onclick="logout()">ðŸ”“ Logout</button>
        </div>
      </div>
    </header>
    <p>Welcome, <strong id="userDisplay"></strong></p>
    <!-- sensors, charts, history, etc. -->
  </div>

  <script>
    let currentUser = null;
    let darkMode = false;
    let chartType = 'line';
    const charts = {};

    function handleGoogleLogin(response) {
      console.log("Google Sign-In response:", response);

      const data = jwt_decode(response.credential);
      const userEmail = data.email;
      if (!userEmail) {
        console.error("Email not found in Google response.");
        return;
      }

      // Show dashboard
      currentUser = userEmail;
      document.getElementById("loginBox").classList.add("hidden");
      document.getElementById("dashboard").classList.remove("hidden");
      document.getElementById("userDisplay").textContent = userEmail;

      // Auth to backend
      fetch("https://iwqd.onrender.com/api/auth", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email: userEmail })  // Use correct JSON object
      });

      // Initialize charts
      updateCharts();
      setInterval(updateCharts, 10000);
    }

    function toggleMenu() {
      document.getElementById("menuPanel").classList.toggle("active");
    }

    function toggleDarkMode() {
      darkMode = !darkMode;
      document.body.classList.toggle('dark-mode');
    }

    function toggleGraphType() {
      chartType = chartType === 'line' ? 'bar' : 'line';
      Object.values(charts).forEach(chart => {
        chart.config.type = chartType;
        chart.update();
      });
    }

    function logout() {
      currentUser = null;
      document.getElementById("dashboard").classList.add("hidden");
      document.getElementById("loginBox").classList.remove("hidden");
    }

    function updateCharts() {
      console.log("ðŸ“Š Updating charts...");
      // Add your fetch and update logic here for each chart
    }

    // You can optionally check for existing login here using `window.onload`, but it's not required
    // for Google Sign-In because Google handles it via cookies/session
  </script>
</body>
</html>

